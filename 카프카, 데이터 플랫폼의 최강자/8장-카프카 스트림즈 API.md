# 8. 카프카 스트림즈 API
처음엔 메시지를 다른 프로세스나 애플리케이션에 전달하기 위해 사용된 카프카.
강력한 성능으로 일련의 연속된 메시지인 스트림을 처리하는데에도 점차 사용되기 시작했다.

## 8.1 스트림 프로세싱 기초
스트림 프로세싱 : 데이터들이 지속적으로 유입되고 나가는 과정에서 이 데이터에 대한 분석이나 질의를 수행하는 것
데이터가 분석 시스템이나 프로그램에 도달하자마자 처리를 하기 때문에 스트림 프로세싱은 실시간 분석이라고도 불린다.

반대되는 개념으로는 배치처리 또는 정적 데이터 처리를 들 수 있다.

**스트림 프로세싱의 장점**
- 애플리케이션이 이벤트에 즉각적으로 반응한다. 이벤트 발생 -> 분석 -> 조치에 이르는 과정 중에 지연시간이 거의 없다.
- 데이터를 저장한 후에 분석을 하지 않으므로 정적 분석보다 더 많은 데이터를 분석할 수 있다.
- 스트림 프로세싱은 시간에 따라 지속적으로 유입되는 데이터 분석에 최적화되어있다.
- 스트림 처리는 대규모 공유 데이터베이스에 대한 요구를 줄일 수 있따.

### 상태기반과 무상태 스트림 처리
스트림 처리를 하다 보면 이전 스트림을 처리한 결과를 참조해야하는 경우가 있다.
이런 류의 처리 방식을 `상태기반 처리`라고 한다.

상태기반스트림 처리를 하기 위해서는 `상태저장소`가 필요하다.

스트림 처리 애플리케이션이 이 장소를 관리하면 `내부 상태 저장소`
스트림 처리 애플리케이션이 DB와 같이 별도의 상태 저장소를 사용하는 것을 `외부 상태 저장소` 라 한다.

`무상태 스트림 처리`는 이전 스트림의 처리 결과와 관계 없이 현재 애플리케이션에 도달한 스트림만을 기준으로 처리하는 것을 말한다.

## 8.2 카프카 스트림즈
스트림 처리를 위해 만들어진 카프카 스트림즈에 대해 알아보자

### 카프카 스트림즈의 특징과 개념
`카프카 스트림즈`는 카프카에 저장된 데이터를 처리하고 분석하기 위해 개발된 클라이언트 라이브러리이다.

**카프카 스트림즈의 특징**
- 간단하고 가벼운 클라이언트 라이브러리이며 기존 애플리케이션이나 자바 애플리케이션에서 쉽게 사용가능하다
- 시스템이나 카프카에 대한 의존성이 없다
- 이중화된 로컬 상태 저장소를 지원한다
- 카프카 브로커나 클라이언트에 장애가 생기더라도 스트림에 대해선 1번만 처리되도록 보장한다.
- 밀리초단위의 처리지연을 보장하기 위해 한 번에 한 레코드만 처리한다
- 간단하게 스트림 처리 프로그램을 만들 수 있도록 고수준의 스트림 DSL을 지원한다. 저수준의 프로세싱 API도 제공한다

카프카 스트림즈는 스트림 처리를 하는 프로세서들이 서로 연결되어 형상, 즉 토폴로지를 만들어서 처리하는 API이다.

**카프카 스트림즈 토폴로지 용어**
- 스트림 : 카프카 스트림즈 API를 사용해 생성된 토포롤지로 끊임없이 전달되는 데이터 세트를 의미한다.
- 스트림 처리 애플리케이션 : 카프카 스트림 클라이언트를 사용하는 애플리케이션을 말함. 
- 스트림 프로세서 : 프로세서 토폴로지를 이루는 하나의 노드를 말함

프로세서 토폴로지 중에는 특별한 프로세서가 있다
- 소스 프로세서 : 위쪽으로 연결된 프로세서가 없는 프로세서를 말함. 하나 이상의 카프카 토픽에서 데이터 레코드를 읽어서 아래쪽 프로세서에 전달한다
- 싱크 프로세서 : 토폴로지 아래쪽에 프로세서가 없는 것을 말함. 상위 프로세서로부터 받은 데이터 레코드를 카프카 특정 토픽에 저장한다.

이과 같은 프로세서를 만들기 위해 카프카 스트림즈 DSL에서 데이터를 처리할 때 필요한 데이터 프로세싱 메소드를 제공하거나,
프로세서 API를 제공해서 저수준의 처리를 직접할 수 있게 하는 것

### 카프카 스트림즈 아키텍쳐
스트림과 카프카 토픽의 관계
- 각 스트림 파티션은 카프카의 토픽 파티션에 저장된 정렬된 메시지이다.
- 스트림의 데이터 레코드는 카프카 해당 토픽의 메시지(키+값)이다.
- 데이터 레코드의 키를 통해 다음 스트림(카프카 토픽)으로 전달.


카프카 스트림즈는 더 많은 스레드를 띄우거나 인스턴스를 생성하는 것만으로도 토폴로지를 복제해서 카프카 파티션을 서로 나눈 다음에 효과적으로 병렬 처리를 수행할 수 있다.


## 8.3 카프카 스트림즈를 위한 환경 설정
## 8.4 파이프 예제 프로그램 만들기
## 8.5 행 분리 예제 프로그램 만들기
## 8.6 단어 빈도수 세기 예제 프로그램 만들기
카프카 1.0버전 이상에서는 이미 카프카 스트림즈가 포함되어 배포되므로 1.0버전 이상에서는 추가로 패키지를 설치할 필요가 없다.

이외 카프카 스트림즈를 사용하는 자바 프로젝트 생성과정은 p.310~ 참고


## 8.7 정리
실시간 스트리밍 분석을 위한 스트림즈 API 특징과 아키텍처 학습.
카스카 스트림즈 API를 이용하면 스파크나 스톰같은 별도 스트리밍 엔진을 사용하지 않고도 간단하게 실시간 분석을 수행할 수 있다.