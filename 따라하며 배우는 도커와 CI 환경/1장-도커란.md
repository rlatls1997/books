# 1. 도커란?
도커를 사용하는 이유는 무엇인가?
도커는 무엇인가?

에 대한 기본적인 내용학습

## 1.1 도커를 사용하는 이유
간단하게 말하면 어떠한 프로그램을 내려받는 과정을 굉장히 간단하게 만들기 위함.

평소 vm서버 구성할때면 java받고 환경변수 설정하고, nginx받고 설치하고, 그 외 기타등등 설정을 하는데 도커를 사용하면 이러한 과정을 굉장히 간단하게 해결할 수 있다.

도커를 이용해 프로그램을 설치하면 예상치 못한 에러도 덜 발생하며 설치하는 과정도 훨씬 간단해진다.

## 1.2 도커와 컨테이너
**도커**
도커는 애플리케이션을 신속하게 구축, 테스트 및 배포할 수 있는 소프트웨어 플랫폼이다.

**컨테이너**
도커는 소프트웨어를 컨테이너라는 표준화된 유닛으로 패키징하며 이 컨테이너에는 라이브러리, 시스템도구, 코드, 런타임 등 소프트웨어를 실행하는데 필요한 모든 것이 포함되어있다.
도커를 사용하면 환경에 구애받지 않고 애플리케이션을 신속하게 배포 및 확장할 수 있으며 코드가 문제없이 실행될 것임을 확신할 수 있다.

## 1.3 도커 이미지와 도커 컨테이너
**도커 컨테이너**
`도커 컨테이너`는 코드와 모든 종속성을 패키지화하여 응용 프로그램이 한 컴퓨팅환경에서 다른 컴퓨팅 환경우로 빠르고 안정적으로 실행되도록 하는 소프트웨어 표준 단위이다.

**도커 이미지**
`도커이미지`는 코드, 런타임, 시스템 도구, 시스템 라이브러리 및 설정과 같은 응용 프로그램을 실행하는데 필요한 모든 것을 포함하는 가볍고 독립적이며 실행 가능한 소프트웨어 패키지이다.

도커 이미지는 프로그램을 실행하는데 필요한 설정이나 종속성을 갖고 있으며 도커 이미지를 이용해 컨테이너를 생성한다.

## 1.4 도커 설치하기
책은 도커 데스크톱 설치를 진행한다. 도커데스크톱이 유료화되면서 WSL2로 설치 진행

```text
Step1. WSL2 + Ubuntu 설치
https://docs.microsoft.com/ko-kr/windows/wsl/install-win10 가이드를 참조하여 WSL2를 설치
설치가 완료되었다면 터미널(cmd)을 열고 wsl --install -d Ubuntu 명령어로 Ubuntu 20.04를 설치
설치 완료 후 Ubuntu의 pakage를 업그레이드 합니다.
$ sudo apt-get update
$ sudo apt-get upgrade

Step2. Docker 설치 & 사용
https://docs.docker.com/engine/install/ubuntu 를 참고하여 docker-ce를 설치.
설치가 완료되면 wsl내에서 docker를 사용할 수 있음. nginx를 사용하는 경우라면 80,443를 publish할 경우 별 다른 추가설정 없이도 윈도우의 브라우저에서 80,443포트로 접근 가능.

Appendix. Nginx upstream 설정
로컬에 nginx를 띄우는 경우는 대부분 reverse proxy로 로컬(WSL 밖)에 구동된 webapp의 특정 포트로 접근하기 위함.
윈도우 커맨드라인에서 ipconfig /all을 한 뒤 이더넷 어댑터 (WSL)을 찾습니다. 해당 어댑터의 IPv4주소를 nginx의 upstream으로 사용하면 됨.
```

## 1.5 도커를 사용할 때의 흐름
**도커를 사용하는 흐름**
1. 도커 클라이언트에 원하는 명령을 위한 명령어를 입력한다
2. 도커 서버(도커 데몬)가 ㄷ커 클라이언트에 입력한 명령어를 전달받으면 명령어에 따른 이미지를 생성하고 컨테이너를 실행한다. 해당 컨테이너에서 애플리케이션을 실행한다.

설치하고나서 `docker run hello-world`로 도커에서 프로그램을 실행해보자.

**hello-world 프로그램을 실행했을 때의 도커 내부 처리 과정**
1. 도커 클라이언트에 명령어를 입력하면 도커 서버로 전달된다.
2. 서버에서 hello-world 이미지가 로컬에 다운로드 되어있는지 확인한다.
3. 내려받은 이미지가 없다면 도커 허브에서 이미지를 가져와 로컬에 보관한다.
4. 내려받은 이미지를 이용하여 컨테이너를 생성한다
5. 생성된 컨테이너는 이미지에서 받은 설정이나 조건에 따라 프로그램을 실행한다.

## 1.6 도커와 기존 가상화 기술의 차이점
### 가상화 기술이 나오기 전에 서버를 사용하던 방식
가상화 기술이 나오기 전에는 한대의 서버를 하나의 용도로만 사용했다.
남는 서버공간은 방치되었다.

그리고 하나의 서버에 하나의 운영체제, 하나의 프로그램만을 운영한다.

이 방식은 안정적이지만 리소스를 제대로 활용하지 않기 때문에 비효율적이다.

### 하이퍼바이저 기반의 가상화 기술
논리적으로 공간을 분할하여 가상 머신(VM)이라는 독립적인 가상 환경에서 서버를 이용하는 기술

한대의 서버를 하나의 용도로 사용했던 비효율적인 부분을 해결할 수 있게 되었다.
`하이퍼바이저`는 호스트 시스템에서 다수의 게스트 운영체제(OS)를 구동할 수 있게 하는 소프트웨어이며 하드웨어를 가상화하면서 하드웨어와 각각의 vM을 모니터링하는 중간 관리자이다.

**하이퍼바이저의 종류**
- 네이티브 하이퍼바이저 : 하이퍼바이저가 하드웨어를 직접 제어. 자원을 효율적으로 사용할 수 있으나 설치가 어렵다.
- 호스트형 하이퍼바이저 : 하드웨어 자원을 VM내부의 게스트 OS에 에뮬레이트(각 VM의 OS에 맡기는건가?) 하는 방식. 오버헤드가 크지만 게스트 OS에 대한 제약이 없고 구현이 다소 쉽다.

논리적으로 분리되엉 있어서 하나의 가상 머신에 오류가 발생해도 다른 가상 머신으로 오류가 퍼지지 않음.

**도커 컨테이너 구조와 VM의 차이**
격리된 환경을 얼마나 격리시키는지가 다르다.
도커 컨테이너는 같은 호스트의 다른 컨테이너와 동일한 커널을 공유한다.
컨테이너가 전체 OS를 내장할 필요가 없기 때문에 매우 가볍고 용량이 적다.

VM은 각 VM만을 위한 커널을 부팅하고 운영체제 프로세스세트를 시작해야 한다는 점이 컨테이너와 다르다.


**Cgroup과 네임스페이스**
다른 프로세스 사이에 벽을 만드는 리눅스 커널의 기능

Cgroup : CPU, 메모리, 네트워크 대역폭, HD I/O등 프로세스 그룹의 시스템 리소스 사용량을 관리함.
예로, 어떤 애플리케이션의 사용량이 너무 많다면 그 애플리케이션을 Cgroup에 배치해서 CPU와 메모리 사용을 제한할 수 있다.
네임스페이스 : 하나의 시스템에서 프로세스를 격리시킬 수 있는 가상화 기술. 별개의 독립된 공간을 사용하는 것처럼 격리된 환경을 제공하는 경량 프로세스 가상화 기술

## 1.7 도커 이미지로 도커 컨테이너 만들기
어떻게 컨테이너가 도커 이미지를 이용해서 생성되는지 알아보자.

도커이미지는 응용프로그램을 실행하는 데 필요한 모든것을 포함하고 있다.
**응용프로그램을 실행하는데 필요한 것**
- 컨테이너가 시작될 때 실행할 명령어
- 실행하고자 하는 프로그램을 구성하는 파일 스냅숏

### 도커 컨테이너가 생성되는 순서
1. 도커 클라이언트에 `ducker run <iamge>` 명령어를 입력한다.
2. 도커 이미지에 있는 파일 스냅숏을 컨테이너에 있는 하드디스크로 옮겨준다.
3. 도커 이미지에서 가지고 있는 명령어를 컨테이너에 전달한다
4. 컨테이너가 실행될때 명령어를 이용해 애플리케이션을 실행한다.

## 1.8 Cgroup, 네임스페이스를 쓸 수 있는 이유
Cgroup과 네임스페이스는 리눅스 횐경에서 사용되는 것인데 어떻게 윈도우 환경이나 macOS환경에서도 커넽이너가 격리되는 것인가?
=> 컴퓨터가 윈도우 또는 macOS환경이어도 도커 서버는 리눅스 VM 환경에서 실행되고 있기 때문이다.
