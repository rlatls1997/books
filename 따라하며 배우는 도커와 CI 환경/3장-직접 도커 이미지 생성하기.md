# 3. 직접 도커 이미지 생성하기
도커 이미지를 직접 만들어보자

## 3.1 도커 이미지를 생성하는 순서
도커이미지 : 컨테이너를 만드는 데 필요한 설정이나 종속성을 가진 소프트웨어 패키지

도커 이미지를 이용해 도커 컨테이너를 생성한다.

다른사람이 만들어둔 이미지를 `도커허브(Docker Hub)`에서 내려받을 수도 있고 직접 이미지를 만들거나 업도르할수도 있다.

### 도커 이미지를 생성하는 순서
1. 도커 파일(Dockerfile)이라는 파일을 작성한다
2. 도커 파일에 입력한 명령들이 도커 클라이언트에 전달된다.
3. 도커 클라이언트에 전달된 명령들을 도커 서버에서 처리하여 도커 이미지를 만들어준다.

즉 도커 이미지를 만들기 위해 도커 파일을 작성해야한다

## 3.2 도커 파일(Dockerfile) 만들기

### 도커파일이란?
이미지를 만들기위한 설정파일.
도커 컨테이너가 어떻게 행동해야 하는지에 대한 설정을 정의함

### 도커 파일 작성 방법
1. 베이스 이미지를 명시한다.
2. 베이스 이미지 외에 애플리케이션을 실행하는데에 필요한 파일들을 이미지 안에 내려받기 위한 명령어를 명시한다.
3. 컨테이너 시작시에 실행할 명령어를 명시한다.

### 베이스 이미지란 무엇인가?
베이스이미지 : 생성하고자 하는 이미지의 기반이 되는 부분, 이미지를 만들기 위한 기보 ㄴ이미지

ex) 어떤 프로그램을 만들려고 한다.
이 때 프로그램은 OS위에 설치해야한다고 가정할때
OS는 이미지를 만들기 위한 기본 이미지가 되며 실제 프로그램을 위한 부분이 레이어가 된다.
이 레이어를 중간단계의 이미지라고 생각하면 된다.
레이어를 이미지에 추가하는 것을 `레이어 캐싱`이라고 한다.

### 도커 파일 작성하기
hello라는 문구를 출력해주는 애플리케이션을 실행하는 도커 이미지를 만들어보자
```dockerfile
FROM alpine

CMD ["echo", "hello"]
```

```dockerfile
# 베이스 이미지를 명시한다
FROM alpine

# 추가로 필요한 파일들을 내려받는다
RUN command

# 컨테이너 시작 시 실행할 명령어를 명시한다.
CMD ["executable"]
```
*FROM*
- 이미지 생성시 기반이 되는 이미지 레이어를 명시한다.
- <이미지이름>:<태그>형식으로 작성한다. ex)ubuntu:14.04
- 태그를 붙이지 않으면 가장 최신버전으로 내려받는다

*RUN*
- 도커 이미지가 생성되기 전에 수행할 쉘 명령어

*CMD*
- 컨테이너가 시작됐을 때 실행할 실행 파일 또는 쉘 스크립트
- 도커 파일 내에서 한 번만 사용할 수 있다.


## 3.3 Buildkit 비활성화하기
도커 18.09부터 도커 이미지를 빌드할 대 기본적으로 지원하는 Buildkit

### Buildkit이란 무엇인가?
도커 18.09버전부터 도커 파일을 이용해 더코 이미지를 빌드할 때 Buildkit을 기본적으로 사용한다
Buildkit은 도커파일을 빌드할때 더 빠른 속도로 효율적으로 빌드할 수 있게 해준다.

실제 도커를 사용할때는 Buildkit을 사용하는 게 좋다

### Buildkit을 이용했을 때의 차이점
사용할때와 사용하지 않았을때의 차이점은 빌드 프로세스 마지막 부분에 나오는 이미지 ID이다.(형식이 조금 다름)

... 이건 pass, p.66참고

## 3.4 도커 파일로 도커 이미지 만들기
`docker build ./`, `docker build .`

### build 명령어는 무엇인가요?
build명령어는 해당 디렉터리에서 Dockerfile이라는 파일을 찾아서 도커 클라이언트에 전달한다.

### build 명령어로 이미지 빌드하기

## 3.5 내가 만든 이미지에 기억하기 쉬운 이름 붙여주기
빌드된 도커 이미지는 기억하거나 입력하기 어렵다
도커이미지에 이름을 붙여보자

### 도커 이미지에 이름 붙여주기 - docker build -t
t(tag)

`docker build -t johnahn/hello:lastest .`

`-t johnahn/hello:lastest`
-> `-t <나의 도커 아이디>/<저장소/프로젝트이름>:<버전>`



